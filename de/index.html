<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Coding Literacy</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Layout: Sidebar links, Content rechts */
    body {
      max-width: none;
      padding: 0;
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar - 6 Kompetenzbereiche */
    .sidebar-graphic {
      position: fixed;
      left: 0;
      top: 0;
      width: 200px;
      height: 100vh;
      background: var(--bg, #FFFFF8);
      border-right: 1px solid #999999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 2rem 1.5rem;
      gap: 4px;
    }

    .competency-bar {
      display: flex;
      align-items: center;
      height: 40px;
      width: 100%;
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
    }

    .competency-bar:hover,
    .competency-bar.active {
      transform: translateX(8px);
      box-shadow: -4px 0 0 rgba(0,0,0,0.3);
    }

    .bar-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      font-weight: bold;
      color: rgba(255,255,255,0.85);
      padding-left: 12px;
      letter-spacing: 1px;
    }

    /* 6 Kompetenzfarben */
    .comp-CT { background: #4A7C7C; }
    .comp-RE { background: #8B4557; }
    .comp-CE { background: #5B7355; }
    .comp-PE { background: #7B6B8D; }
    .comp-CL { background: #8B7355; }
    .comp-RV { background: #4A6B8C; }

    /* Content rechts */
    .page-wrapper {
      margin-left: 200px;
      flex: 1;
      max-width: 780px;
      padding: 2rem 3rem;
    }

    /* Session-Abschnitte */
    .session-section {
      margin: 3rem 0;
      padding: 2rem 0;
      border-top: 1px solid var(--border, #999999);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .session-section.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .session-section:first-of-type {
      border-top: none;
      margin-top: 0;
    }

    .session-header {
      display: flex;
      align-items: baseline;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }

    .session-number {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 14px;
      color: var(--text-muted, #666666);
    }

    .session-competency {
      display: inline-block;
      width: 8px;
      height: 8px;
    }

    /* Goals Liste */
    .goals-list {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
    }

    .goals-list li {
      padding-left: 1.5rem;
      position: relative;
      margin-bottom: 0.5rem;
    }

    .goals-list li::before {
      content: "→";
      position: absolute;
      left: 0;
      color: var(--text-muted, #666666);
    }

    /* Concepts */
    .concepts {
      margin: 1.5rem 0;
    }

    .concept {
      margin-bottom: 0.75rem;
    }

    .concept-term {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: bold;
    }

    /* Exercise */
    .exercise {
      background: var(--code-bg, #F0F0F0);
      border: 1px solid var(--border, #999999);
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .exercise h4 {
      margin: 0 0 1rem;
      font-size: 16px;
    }

    /* Reflection */
    .reflection {
      margin: 1.5rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--border, #999999);
    }

    .reflection h4 {
      margin: 0 0 0.5rem;
      font-size: 16px;
      color: var(--text-muted, #666666);
    }

    /* Quote */
    .session-quote {
      font-style: italic;
      color: var(--text-muted, #666666);
      margin: 1.5rem 0;
      padding: 1rem;
      border-left: 4px solid var(--border, #999999);
    }

    .session-quote cite {
      display: block;
      font-style: normal;
      font-size: 14px;
      margin-top: 0.5rem;
    }

    /* Chapter short description */
    .chapter-short {
      font-style: italic;
      color: var(--text-muted, #666666);
      margin-bottom: 1.5rem;
    }

    /* Theory block */
    .theory-block {
      margin: 1.5rem 0;
    }

    /* Hands-On section */
    .hands-on-section {
      margin: 2rem 0;
    }

    .hands-on-section h4 {
      border-bottom: 1px solid var(--border, #999999);
      padding-bottom: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .hands-on-section .exercise {
      margin-bottom: 2rem;
    }

    .hands-on-section h5 {
      font-size: 18px;
      margin: 0 0 0.5rem;
    }

    .hands-on-section h6 {
      font-size: 14px;
      margin: 1rem 0 0.5rem;
      color: var(--text-muted, #666666);
    }

    /* Resources */
    .resources {
      margin: 2rem 0;
      padding: 1rem;
      background: var(--code-bg, #F0F0F0);
      border: 1px solid var(--border, #999999);
    }

    .resources h4 {
      margin: 0 0 1rem;
    }

    .resources ul {
      margin: 0;
      padding-left: 1.5rem;
    }

    .resources li {
      margin-bottom: 0.5rem;
    }

    .resource-type {
      font-size: 12px;
      color: var(--text-muted, #666666);
    }

    /* Loading indicator */
    .loading {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted, #666666);
      font-family: 'IBM Plex Mono', monospace;
    }

    /* Kompetenz-Liste im Intro */
    .competency-list {
      list-style: none;
      padding-left: 0;
    }

    .competency-list li {
      display: flex;
      align-items: baseline;
      gap: 0.75rem;
      margin-bottom: 0.4rem;
    }

    .comp-marker {
      display: inline-block;
      width: 12px;
      height: 12px;
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 1000px) {
      .sidebar-graphic {
        display: none;
      }
      .page-wrapper {
        margin-left: 0;
        max-width: 720px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar: 6 Kompetenzbereiche als Navigation -->
  <aside class="sidebar-graphic" id="sidebar">
    <!-- Wird dynamisch aus JSON gefüllt -->
  </aside>

  <!-- Page Content -->
  <div class="page-wrapper">
    <nav>
      <a href="/de/" class="active">Übersicht</a>
      <a href="/de/kompetenzmodell.html">Kompetenzmodell</a>
      <a href="/de/referenz.html">Referenz</a>
    </nav>

    <main id="content">
      <!-- Intro-Bereich -->
      <section id="intro">
        <h1 id="title">AI Coding Literacy</h1>
        <p id="subtitle"></p>
        <p id="description"></p>
      </section>

      <!-- Kompetenzmodell-Übersicht -->
      <section id="competencies-overview">
        <h2>Kompetenzmodell</h2>
        <p>Das Curriculum entwickelt sechs Kompetenzbereiche:</p>
        <ul class="competency-list" id="competency-list">
          <!-- Wird dynamisch gefüllt -->
        </ul>
      </section>

      <!-- Sessions werden hier dynamisch geladen -->
      <section id="sessions-section">
        <h2>Sessions</h2>
        <div id="sessions-container"></div>
        <div class="loading" id="loading">Lade Sessions...</div>
      </section>
    </main>

    <footer>
      <a href="https://github.com/DigitalHumanitiesCraft/ai-coding-literacy">GitHub</a> ·
      DigitalHumanitiesCraft · 2025
    </footer>
  </div>

  <script>
    // State
    let contentData = null;
    let loadedChapters = 0;
    const CHAPTERS_PER_LOAD = 2;

    // Load JSON data
    async function loadContent() {
      try {
        const response = await fetch('/data/content.json');
        contentData = await response.json();
        initPage();
      } catch (error) {
        console.error('Fehler beim Laden:', error);
        document.getElementById('loading').textContent = 'Fehler beim Laden der Inhalte.';
      }
    }

    // Initialize page with meta and chapters
    function initPage() {
      // Meta
      document.getElementById('subtitle').textContent = contentData.meta.subtitle;
      document.getElementById('description').textContent = contentData.meta.description;

      // Sidebar - now from chapters
      const sidebar = document.getElementById('sidebar');
      contentData.chapters.forEach(chapter => {
        const link = document.createElement('a');
        link.href = `#chapter-${chapter.id}`;
        link.className = `competency-bar comp-${chapter.id}`;
        link.title = chapter.name;
        link.innerHTML = `<span class="bar-label">${chapter.id}</span>`;
        link.addEventListener('click', (e) => {
          e.preventDefault();
          scrollToChapter(chapter.id);
        });
        sidebar.appendChild(link);
      });

      // Competency list in overview
      const list = document.getElementById('competency-list');
      contentData.chapters.forEach(chapter => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="comp-marker" style="background: ${chapter.color}"></span>
          <strong>${chapter.name}</strong> – ${chapter.short}
        `;
        list.appendChild(li);
      });

      // Load initial chapters
      loadMoreChapters();

      // Setup Intersection Observer for infinite scroll
      setupInfiniteScroll();

      // Setup scroll spy for sidebar
      setupScrollSpy();
    }

    // Scroll to chapter
    function scrollToChapter(chapterId) {
      // First, load all chapters to ensure target exists
      while (loadedChapters < contentData.chapters.length) {
        loadMoreChapters();
      }

      const element = document.getElementById(`chapter-${chapterId}`);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // Load more chapters
    function loadMoreChapters() {
      const container = document.getElementById('sessions-container');
      const loading = document.getElementById('loading');

      const chaptersToLoad = contentData.chapters.slice(
        loadedChapters,
        loadedChapters + CHAPTERS_PER_LOAD
      );

      if (chaptersToLoad.length === 0) {
        loading.style.display = 'none';
        return;
      }

      chaptersToLoad.forEach(chapter => {
        const section = createChapterElement(chapter);
        container.appendChild(section);

        // Trigger visibility animation
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            section.classList.add('visible');
          });
        });
      });

      loadedChapters += chaptersToLoad.length;

      if (loadedChapters >= contentData.chapters.length) {
        loading.style.display = 'none';
      }
    }

    // Create chapter HTML element
    function createChapterElement(chapter) {
      const section = document.createElement('section');
      section.className = 'session-section';
      section.id = `chapter-${chapter.id}`;
      section.dataset.competency = chapter.id;

      let html = `
        <div class="session-header">
          <span class="session-number">${chapter.id}</span>
          <span class="session-competency" style="background: ${chapter.color}"></span>
        </div>
        <h3>${chapter.name}</h3>
        <p class="chapter-short">${chapter.short}</p>
      `;

      // Theory section
      if (chapter.theory) {
        html += `
          <div class="theory-block">
            <p>${chapter.theory.description}</p>
        `;

        // Key Points
        if (chapter.theory.keyPoints && chapter.theory.keyPoints.length > 0) {
          html += `<h4>Kernpunkte</h4><ul class="goals-list">`;
          chapter.theory.keyPoints.forEach(point => {
            html += `<li>${point}</li>`;
          });
          html += `</ul>`;
        }

        // Concepts
        if (chapter.theory.concepts && chapter.theory.concepts.length > 0) {
          html += `<div class="concepts"><h4>Konzepte</h4>`;
          chapter.theory.concepts.forEach(concept => {
            html += `<p class="concept"><span class="concept-term">${concept.term}</span> – ${concept.definition}</p>`;
          });
          html += `</div>`;
        }

        html += `</div>`;
      }

      // Hands-On sections
      if (chapter.handsOn && chapter.handsOn.length > 0) {
        html += `<div class="hands-on-section"><h4>Hands-On Übungen</h4>`;

        chapter.handsOn.forEach((exercise, index) => {
          html += `
            <div class="exercise" id="exercise-${exercise.id}">
              <h5>${exercise.id}: ${exercise.title}</h5>
              <p>${exercise.summary}</p>
          `;

          // Goals
          if (exercise.goals && exercise.goals.length > 0) {
            html += `<p><strong>Lernziele:</strong></p><ul class="goals-list">`;
            exercise.goals.forEach(goal => {
              html += `<li>${goal}</li>`;
            });
            html += `</ul>`;
          }

          // Exercise details
          if (exercise.exercise) {
            if (exercise.exercise.description) {
              html += `<p>${exercise.exercise.description}</p>`;
            }
            if (exercise.exercise.code) {
              html += `
                <div class="code-block">
                  <div class="code-header">
                    <span class="filename">${exercise.exercise.filename || 'code.py'}</span>
                    <button class="copy-btn" onclick="copyCode(this)">kopieren</button>
                  </div>
                  <pre><code>${escapeHtml(exercise.exercise.code)}</code></pre>
                </div>
              `;
            }
            if (exercise.exercise.task) {
              html += `<p><strong>Aufgabe:</strong> ${exercise.exercise.task}</p>`;
            }
          }

          // Reflection
          if (exercise.reflection && exercise.reflection.length > 0) {
            html += `<div class="reflection"><h6>Reflexion</h6><ul>`;
            exercise.reflection.forEach(q => {
              html += `<li>${q}</li>`;
            });
            html += `</ul></div>`;
          }

          html += `</div>`;
        });

        html += `</div>`;
      }

      // Resources
      if (chapter.resources && chapter.resources.length > 0) {
        html += `<div class="resources"><h4>Ressourcen</h4><ul>`;
        chapter.resources.forEach(res => {
          html += `<li><a href="${res.url}" target="_blank">${res.title}</a> <span class="resource-type">(${res.type})</span></li>`;
        });
        html += `</ul></div>`;
      }

      // Quote
      if (chapter.quote) {
        html += `
          <blockquote class="session-quote">
            "${chapter.quote.text}"
            <cite>— ${chapter.quote.source}</cite>
          </blockquote>
        `;
      }

      section.innerHTML = html;
      return section;
    }

    // Setup Intersection Observer for infinite scroll
    function setupInfiniteScroll() {
      const loading = document.getElementById('loading');

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && loadedChapters < contentData.chapters.length) {
            loadMoreChapters();
          }
        });
      }, {
        rootMargin: '200px'
      });

      observer.observe(loading);
    }

    // Setup scroll spy for sidebar highlighting
    function setupScrollSpy() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const competency = entry.target.dataset.competency;

            // Update sidebar
            document.querySelectorAll('.competency-bar').forEach(bar => {
              bar.classList.remove('active');
              if (bar.classList.contains(`comp-${competency}`)) {
                bar.classList.add('active');
              }
            });
          }
        });
      }, {
        rootMargin: '-50% 0px -50% 0px'
      });

      // Observe existing and future chapter sections
      const container = document.getElementById('sessions-container');
      const mutationObserver = new MutationObserver((mutations) => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach(node => {
            if (node.classList && node.classList.contains('session-section')) {
              observer.observe(node);
            }
          });
        });
      });

      mutationObserver.observe(container, { childList: true });
    }

    // Utility: Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Copy code function
    function copyCode(button) {
      const codeBlock = button.closest('.code-block');
      const code = codeBlock.querySelector('code').textContent;

      navigator.clipboard.writeText(code).then(() => {
        const originalText = button.textContent;
        button.textContent = 'kopiert!';
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', loadContent);
  </script>
</body>
</html>
